{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.25_typescript@6.0.0-dev.20250807__webpack@5.103.0/node_modules/vue-loader/dist/exportHelper.js","src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/external var \"Vue\"","webpack://tavern_helper_template/./src/性斗学园/变量更新UI/app.vue?1d97","webpack://tavern_helper_template/src/性斗学园/变量更新UI/app.vue?2451","src://tavern_helper_template/src/性斗学园/变量更新UI/index.ts"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// runtime helper for setting properties on components\n// in a tree-shakable way\nexports.default = (sfc, props) => {\n    const target = sfc.__vccOpts || sfc;\n    for (const [key, val] of props) {\n        target[key] = val;\n    }\n    return target;\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","const __WEBPACK_NAMESPACE_OBJECT__ = Vue;","import { defineComponent as _defineComponent } from 'vue';\nimport { createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, normalizeClass as _normalizeClass, vShow as _vShow, withDirectives as _withDirectives, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = { class: \"variable-update-beautifier\" };\nconst _hoisted_2 = {\n    key: 0,\n    class: \"update-container\"\n};\nconst _hoisted_3 = { class: \"header-left\" };\nconst _hoisted_4 = { class: \"update-content\" };\nconst _hoisted_5 = [\"innerHTML\"];\nconst _hoisted_6 = {\n    key: 1,\n    class: \"no-update\"\n};\nimport { ref, onMounted, computed } from 'vue';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'app',\n    setup(__props) {\n        const updateContent = ref('');\n        const isExpanded = ref(false);\n        // 格式化内容\n        const formattedContent = computed(() => {\n            if (!updateContent.value)\n                return '';\n            let content = updateContent.value;\n            // 处理 <Analysis> 标签\n            content = content.replace(/<Analysis>([\\s\\S]*?)<\\/Analysis>/gi, (match, analysisContent) => {\n                return `\n        <div class=\"analysis-section\">\n          <div class=\"section-header\">\n            <i class=\"fas fa-search\"></i>\n            <span>分析</span>\n          </div>\n          <div class=\"section-content\">\n            ${formatAnalysisContent(analysisContent.trim())}\n          </div>\n        </div>\n      `;\n            });\n            // 处理 <JSONPatch> 标签\n            content = content.replace(/<JSONPatch>([\\s\\S]*?)<\\/JSONPatch>/gi, (match, jsonContent) => {\n                return `\n        <div class=\"jsonpatch-section\">\n          <div class=\"section-header\">\n            <i class=\"fas fa-code\"></i>\n            <span> 变量更新代码 </span>\n          </div>\n          <div class=\"section-content\">\n            ${formatJSONContent(jsonContent.trim())}\n          </div>\n        </div>\n      `;\n            });\n            return content;\n        });\n        // 格式化分析内容\n        const formatAnalysisContent = (content) => {\n            // 转义HTML\n            let formatted = content.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');\n            // 处理列表项（以 - 开头）\n            formatted = formatted.replace(/^- (.+)$/gm, '<div class=\"analysis-item\">• $1</div>');\n            // 处理子列表项（以   - 开头，有缩进）\n            formatted = formatted.replace(/^  - (.+)$/gm, '<div class=\"analysis-subitem\">  • $1</div>');\n            // 恢复换行\n            formatted = formatted.replace(/\\n/g, '<br>');\n            return formatted;\n        };\n        // 格式化JSON内容\n        const formatJSONContent = (content) => {\n            try {\n                // 尝试解析JSON\n                const json = JSON.parse(content);\n                // 格式化JSON\n                const formatted = JSON.stringify(json, null, 2);\n                // 高亮JSON语法\n                return highlightJSON(formatted);\n            }\n            catch (error) {\n                // 如果解析失败，直接显示原始内容\n                return `<pre class=\"json-error\">${escapeHTML(content)}</pre>`;\n            }\n        };\n        // 高亮JSON语法\n        const highlightJSON = (json) => {\n            let highlighted = escapeHTML(json);\n            // 先高亮操作类型（特殊处理）\n            highlighted = highlighted.replace(/\"op\"\\s*:\\s*\"([^\"]+)\"/g, '<span class=\"json-key\">\"op\"</span>: <span class=\"json-op\">\"$1\"</span>');\n            // 高亮键名（但不包括已经处理过的 \"op\"）\n            highlighted = highlighted.replace(/\"([^\"]+)\"\\s*:/g, (match, key) => {\n                if (key === 'op')\n                    return match; // 跳过已处理的 op\n                return `<span class=\"json-key\">\"${key}\"</span>:`;\n            });\n            // 高亮字符串值（值部分）\n            highlighted = highlighted.replace(/:\\s*\"([^\"]+)\"/g, ': <span class=\"json-string\">\"$1\"</span>');\n            // 高亮数组中的字符串\n            highlighted = highlighted.replace(/\\[\\s*\"([^\"]+)\"\\s*\\]/g, '[<span class=\"json-string\">\"$1\"</span>]');\n            highlighted = highlighted.replace(/\"([^\"]+)\",/g, '<span class=\"json-string\">\"$1\"</span>,');\n            // 高亮数字\n            highlighted = highlighted.replace(/:\\s*(\\d+)/g, ': <span class=\"json-number\">$1</span>');\n            // 高亮布尔值\n            highlighted = highlighted.replace(/:\\s*(true|false)/g, ': <span class=\"json-boolean\">$1</span>');\n            // 高亮null\n            highlighted = highlighted.replace(/:\\s*(null)/g, ': <span class=\"json-null\">$1</span>');\n            return `<pre class=\"json-code\">${highlighted}</pre>`;\n        };\n        // 转义HTML\n        const escapeHTML = (text) => {\n            return text\n                .replace(/&/g, '&amp;')\n                .replace(/</g, '&lt;')\n                .replace(/>/g, '&gt;')\n                .replace(/\"/g, '&quot;')\n                .replace(/'/g, '&#039;');\n        };\n        // 切换展开/折叠\n        const toggleExpand = () => {\n            isExpanded.value = !isExpanded.value;\n        };\n        // 提取并显示更新内容\n        const extractUpdateContent = () => {\n            try {\n                // 获取当前消息ID\n                const messageId = getCurrentMessageId();\n                // 获取当前消息内容\n                const messages = getChatMessages(messageId);\n                if (messages.length === 0) {\n                    console.warn('[变量更新] 未找到当前消息');\n                    return;\n                }\n                const message = messages[0];\n                const messageText = message.message;\n                // 使用正则表达式提取 <update> 或 <UpdateVariable> 标签中的内容\n                const regex = /<update(?:variable)?>([\\s\\S]*?)<\\/update(?:variable)?>/gi;\n                const match = regex.exec(messageText);\n                if (match && match[1]) {\n                    updateContent.value = match[1].trim();\n                    console.info('[变量更新] 已提取更新内容，长度:', updateContent.value.length);\n                }\n                else {\n                    console.info('[变量更新] 未找到 <update> 或 <UpdateVariable> 标签');\n                }\n            }\n            catch (error) {\n                console.error('[变量更新] 提取内容时出错:', error);\n            }\n        };\n        onMounted(() => {\n            console.info('[变量更新] 组件已加载');\n            // 延迟提取，确保消息已加载\n            setTimeout(() => {\n                extractUpdateContent();\n            }, 100);\n        });\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                (updateContent.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [\n                        _createElementVNode(\"div\", {\n                            class: _normalizeClass([\"update-card\", { 'is-expanded': isExpanded.value }])\n                        }, [\n                            _createCommentVNode(\" 折叠栏头部 \"),\n                            _createElementVNode(\"div\", {\n                                class: \"update-header\",\n                                onClick: toggleExpand\n                            }, [\n                                _createElementVNode(\"div\", _hoisted_3, [\n                                    _createElementVNode(\"div\", {\n                                        class: _normalizeClass([\"expand-icon\", { rotated: isExpanded.value }])\n                                    }, [...(_cache[0] || (_cache[0] = [\n                                            _createElementVNode(\"i\", { class: \"fas fa-chevron-down\" }, null, -1 /* CACHED */)\n                                        ]))], 2 /* CLASS */),\n                                    _cache[1] || (_cache[1] = _createElementVNode(\"div\", { class: \"header-title\" }, [\n                                        _createElementVNode(\"i\", { class: \"fas fa-sync-alt\" }),\n                                        _createElementVNode(\"span\", null, \"变量更新\")\n                                    ], -1 /* CACHED */))\n                                ]),\n                                _cache[2] || (_cache[2] = _createElementVNode(\"div\", { class: \"header-badge\" }, [\n                                    _createElementVNode(\"i\", { class: \"fas fa-code\" })\n                                ], -1 /* CACHED */))\n                            ]),\n                            _createCommentVNode(\" 折叠内容 \"),\n                            _withDirectives(_createElementVNode(\"div\", _hoisted_4, [\n                                _createElementVNode(\"div\", {\n                                    class: \"content-wrapper\",\n                                    innerHTML: formattedContent.value\n                                }, null, 8 /* PROPS */, _hoisted_5)\n                            ], 512 /* NEED_PATCH */), [\n                                [_vShow, isExpanded.value]\n                            ])\n                        ], 2 /* CLASS */)\n                    ]))\n                    : (_openBlock(), _createElementBlock(\"div\", _hoisted_6, [...(_cache[3] || (_cache[3] = [\n                            _createElementVNode(\"p\", null, \"未找到变量更新内容\", -1 /* CACHED */)\n                        ]))]))\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./app.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./app.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./app.vue?vue&type=style&index=0&id=31b62c22&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.25_typescript@6.0.0-dev.20250807__webpack@5.103.0/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-31b62c22\"]])\n\nexport default __exports__","import { createApp } from 'vue';\nimport app from './app.vue';\n\n$(() => {\n  createApp(app).mount('#app');\n});\n"],"names":["exports","sfc","props","target","__vccOpts","key","val","__webpack_module_cache__","Vue","_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","__name","setup","__props","updateContent","ref","isExpanded","formattedContent","computed","value","content","replace","match","analysisContent","formatAnalysisContent","trim","jsonContent","formatJSONContent","formatted","json","JSON","parse","stringify","highlightJSON","error","escapeHTML","highlighted","text","toggleExpand","onMounted","console","info","setTimeout","messageId","getCurrentMessageId","messages","getChatMessages","length","warn","messageText","message","exec","extractUpdateContent","_ctx","_cache","onClick","rotated","innerHTML","__webpack_require__","moduleId","cachedModule","undefined","module","__webpack_modules__","$","createApp","app","mount"],"ignoreList":[],"sourceRoot":""}