<head><script type="module">var e={426:(e,t)=>{t.A=(e,t)=>{const a=e.__vccOpts||e;for(const[e,n]of t)a[e]=n;return a}}},t={};const a=Vue,n={class:'option-beautifier'},r={key:0,class:'options-container'},o=['onClick'],s={key:0,class:'fight-button-content'},c={class:'option-label'},l={class:'option-content'},i={key:1,class:'no-options'},h=(0,a.defineComponent)({__name:'app',setup(e){const t=(0,a.ref)([]),h=(0,a.ref)(''),d=()=>{try{const e=(e=>{try{const t=window;return t.getChatMessages&&e?t.getChatMessages(e):t.chat&&t.chat.messages?t.chat.messages:[]}catch(e){return console.error('[选项美化] 获取消息失败:',e),[]}})((()=>{try{const e=window;return e.getCurrentMessageId?e.getCurrentMessageId():new URLSearchParams(window.location.search).get('message_id')||null}catch(e){return console.error('[选项美化] 获取消息ID失败:',e),null}})());if(0===e.length)return void console.warn('[选项美化] 未找到当前消息');const a=e[0].message,n=/<option>([\s\S]*?)<\/option>/,r=a.match(n);if(r&&r[1]){const e=r[1].trim();t.value=(e=>{const t=[],a=e.split('\n').map(e=>e.trim()).filter(e=>e.length>0);for(const e of a){if(e.match(/^E\.\s*(.+)$/i)){const a=e.match(/^E\.\s*(.+)$/i);if(a){t.push({label:'E',text:a[1].trim(),isFight:!0});continue}}let a=e.match(/^([A-Z])\.\s*(.+)$/);a||(a=e.match(/^([A-Z])、\s*(.+)$/)),a||(a=e.match(/^([A-Z])\)\s*(.+)$/)),a||(a=e.match(/^\(([A-Z])\)\s*(.+)$/)),a&&t.push({label:a[1],text:a[2].trim()})}if(0===t.length)for(let e=0;e<a.length;e++){const n=a[e].match(/^(\d+)\.\s*(.+)$/);if(n){const e=parseInt(n[1]),a=String.fromCharCode(64+e);t.push({label:a,text:n[2].trim()})}}return t})(e),h.value||(t.value=t.value.filter(e=>!e.isFight)),console.info('[选项美化] 已提取选项，数量:',t.value.length)}else console.info('[选项美化] 未找到 <option> 标签')}catch(e){console.error('[选项美化] 提取选项时出错:',e)}};return(0,a.onMounted)(async()=>{console.info('[选项美化] 组件已加载'),await(async()=>{try{const e=window;if(e.waitGlobalInitialized&&await e.waitGlobalInitialized('Mvu'),!e.Mvu)return void(h.value='');const t=e.Mvu.getMvuData({type:'message',message_id:'latest'}),a=_.get(t,'stat_data.性斗系统.对手名称','');h.value='string'==typeof a?a.trim():''}catch(e){console.error('[选项美化] 获取对手名称失败:',e),h.value=''}})(),setTimeout(()=>{d()},100)}),(e,h)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',n,[t.value.length>0?((0,a.openBlock)(),(0,a.createElementBlock)('div',r,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(t.value,(e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:t,class:(0,a.normalizeClass)(['option-card',{'option-card-hover':!0,'option-card-fight':e.isFight}]),onClick:t=>e.isFight?(()=>{try{const e=window.parent,t=e.$||e.jQuery;if(!t)return void console.warn('[选项美化] 无法访问父窗口的jQuery');const a=(()=>{if(e.chat){const t=e.chat;if(t.characters&&t.characters.length>0)return{name:t.characters[0].name||t.characters[0].title||'Assistant',avatar:t.characters[0].avatar||''};if(t.character)return{name:t.character.name||t.character.title||'Assistant',avatar:t.character.avatar||''}}if(e.character)return{name:e.character.name||e.character.title||'Assistant',avatar:e.character.avatar||''};if(e.chat&&e.chat.messages&&e.chat.messages.length>0){const t=e.chat.messages[e.chat.messages.length-1];if(t&&t.name&&!t.is_user)return{name:t.name,avatar:t.avatar||''}}return{name:'Assistant',avatar:''}})();if(e.executeSlashCommand&&'function'==typeof e.executeSlashCommand){const t=`/sendas name="${a.name}"${a.avatar?` avatar="${a.avatar}"`:''} <fight>`;return e.executeSlashCommand(t),void console.info('[选项美化] 已通过 executeSlashCommand 执行 /sendas 命令')}const n=['#send_textarea','textarea[name="send_textarea"]','.send_textarea','textarea[placeholder*="Message"]','textarea[placeholder*="消息"]','.chat-input textarea','#chat-input textarea'];let r=null;for(const e of n)if(r=t(e),r.length>0)break;if(!r||0===r.length)return void console.warn('[选项美化] 未找到输入框，无法执行 /sendas 命令');let o=`/sendas name="${a.name}"`;a.avatar&&(o+=` avatar="${a.avatar}"`),o+=' <fight>',r.val(o),r.trigger('input'),r.trigger('change'),setTimeout(()=>{const e=['#send_but','button[type="submit"]','.send-button','button.send','[data-send-button]','button[aria-label*="Send"]','button[aria-label*="发送"]'];let a=null;for(const n of e)if(a=t(n),a.length>0&&!a.prop('disabled'))break;if(a&&a.length>0)a.trigger('click'),console.info('[选项美化] 已通过发送按钮执行 /sendas 命令');else{const e=r[0];if(e){const t=new KeyboardEvent('keydown',{key:'Enter',code:'Enter',keyCode:13,which:13,bubbles:!0,cancelable:!0});e.dispatchEvent(t),console.info('[选项美化] 已通过Enter键执行 /sendas 命令')}}},50)}catch(e){console.error('[选项美化] 触发性斗时出错:',e)}})():(e=>{try{const t=window.parent,a=t.$||t.jQuery;if(!a)return void console.warn('[选项美化] 无法访问父窗口的jQuery');const n=['#send_textarea','textarea[name="send_textarea"]','.send_textarea','textarea[placeholder*="Message"]','textarea[placeholder*="消息"]','.chat-input textarea','#chat-input textarea'];let r=null;for(const e of n)if(r=a(e),r.length>0)break;r&&r.length>0?(r.val(e),r.trigger('input'),r.trigger('change'),r.focus(),console.info('[选项美化] 已选择选项:',e)):(console.warn('[选项美化] 未找到输入框'),navigator.clipboard&&navigator.clipboard.writeText(e).catch(()=>{console.warn('[选项美化] 复制到剪贴板失败')}))}catch(e){console.error('[选项美化] 选择选项时出错:',e)}})(e.text)},[(0,a.createCommentVNode)(' 性斗按钮特殊显示 '),e.isFight?((0,a.openBlock)(),(0,a.createElementBlock)('div',s,[...h[0]||(h[0]=[(0,a.createElementVNode)('div',{class:'fight-button-text'},'【发起性斗】',-1)])])):((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:1},[(0,a.createCommentVNode)(' 普通选项显示 '),(0,a.createCommentVNode)(' 选项标签 '),(0,a.createElementVNode)('div',c,(0,a.toDisplayString)(e.label),1),(0,a.createCommentVNode)(' 选项内容 '),(0,a.createElementVNode)('div',l,(0,a.toDisplayString)(e.text),1),(0,a.createCommentVNode)(' 点击提示 '),h[1]||(h[1]=(0,a.createElementVNode)('div',{class:'option-hint'},[(0,a.createElementVNode)('i',{class:'fas fa-mouse-pointer'}),(0,a.createTextVNode)(' 点击选择 ')],-1))],64))],10,o))),128))])):((0,a.openBlock)(),(0,a.createElementBlock)('div',i,[...h[2]||(h[2]=[(0,a.createElementVNode)('p',null,'未找到选项内容',-1)])]))]))}});var d=function a(n){var r=t[n];if(void 0!==r)return r.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,a),o.exports}(426);const m=(0,d.A)(h,[['__scopeId','data-v-f496b0cc']]);$(()=>{(0,a.createApp)(m).mount('#app')});
//# sourceMappingURL=index.js.map</script><style>.option-beautifier[data-v-f496b0cc]{width:100%;margin:0;padding:0}.options-container[data-v-f496b0cc]{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem;padding:1rem 0}.options-container .option-card-fight[data-v-f496b0cc]{grid-column:1/-1;background:linear-gradient(135deg,rgba(239,68,68,0.15) 0%,rgba(220,38,38,0.15) 100%) !important;border-color:rgba(239,68,68,.4) !important;background-image:radial-gradient(circle at 20% 30%,rgba(239,68,68,0.2) 0%,transparent 50%),radial-gradient(circle at 80% 70%,rgba(220,38,38,0.2) 0%,transparent 50%) !important;display:flex !important;align-items:center !important;justify-content:center !important;padding:1.5rem 2rem !important}.options-container .option-card-fight[data-v-f496b0cc]::before{background:linear-gradient(90deg,transparent 0%,rgba(239,68,68,0.6) 25%,rgba(220,38,38,0.6) 75%,transparent 100%) !important}.options-container .option-card-fight[data-v-f496b0cc]:hover{background:linear-gradient(135deg,rgba(239,68,68,0.25) 0%,rgba(220,38,38,0.25) 100%) !important;background-image:radial-gradient(circle at 20% 30%,rgba(239,68,68,0.35) 0%,transparent 50%),radial-gradient(circle at 80% 70%,rgba(220,38,38,0.35) 0%,transparent 50%) !important;border-color:rgba(239,68,68,.7) !important;box-shadow:0 12px 40px rgba(239,68,68,.5),0 6px 20px rgba(220,38,38,.4),inset 0 1px 0 hsla(0,0%,100%,.2) !important;transform:translateY(-3px) scale(1.02) !important}.options-container .option-card-fight:hover .fight-button-text[data-v-f496b0cc]{transform:scale(1.05);text-shadow:0 0 15px #ef4444,0 2px 6px rgba(0,0,0,.6),0 0 30px rgba(239,68,68,.6)}.options-container .option-card-fight[data-v-f496b0cc]:active{transform:translateY(-1px) scale(1) !important}.options-container .fight-button-content[data-v-f496b0cc]{width:100%;display:flex;align-items:center;justify-content:center;padding:1rem 0}.options-container .fight-button-text[data-v-f496b0cc]{color:#fff;font-size:1.5rem;font-weight:800;letter-spacing:.1em;text-align:center;text-shadow:0 0 10px rgba(239,68,68,.8),0 2px 4px rgba(0,0,0,.5),0 0 20px rgba(239,68,68,.4);background:linear-gradient(135deg,#ffffff 0%,#fee2e2 100%);-webkit-background-clip:text;-webkit-text-fill-color:rgba(0,0,0,0);background-clip:text;position:relative}.options-container .fight-button-text[data-v-f496b0cc]::before{content:"【发起性斗】";position:absolute;top:0;left:0;right:0;bottom:0;color:rgba(239,68,68,.3);filter:blur(8px);z-index:-1}.option-card[data-v-f496b0cc]{position:relative;background:linear-gradient(135deg,rgba(99,102,241,0.1) 0%,rgba(236,72,153,0.1) 100%);border:1px solid hsla(0,0%,100%,.15);border-radius:.75rem;padding:1rem 1.25rem;cursor:pointer;transition:all .3s cubic-bezier(0.4,0,0.2,1);backdrop-filter:blur(20px) saturate(180%);box-shadow:0 4px 16px rgba(0,0,0,.2),0 2px 4px rgba(99,102,241,.15),inset 0 1px 0 hsla(0,0%,100%,.1);overflow:hidden;display:flex;align-items:center;gap:1rem;background-image:radial-gradient(circle at 20% 30%,rgba(99,102,241,0.15) 0%,transparent 50%),radial-gradient(circle at 80% 70%,rgba(236,72,153,0.15) 0%,transparent 50%)}.option-card[data-v-f496b0cc]::before{content:"";position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,transparent 0%,rgba(99,102,241,0.6) 25%,rgba(236,72,153,0.6) 75%,transparent 100%);opacity:0;transition:opacity .3s ease}.option-card[data-v-f496b0cc]::after{content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent 0%,rgba(255,255,255,0.1) 50%,transparent 100%);transition:left .5s ease}.option-card[data-v-f496b0cc]:hover{background:linear-gradient(135deg,rgba(99,102,241,0.18) 0%,rgba(236,72,153,0.18) 100%);background-image:radial-gradient(circle at 20% 30%,rgba(99,102,241,0.25) 0%,transparent 50%),radial-gradient(circle at 80% 70%,rgba(236,72,153,0.25) 0%,transparent 50%);border-color:rgba(236,72,153,.4);box-shadow:0 6px 24px rgba(0,0,0,.3),0 2px 8px rgba(99,102,241,.25),inset 0 1px 0 hsla(0,0%,100%,.15);transform:translateY(-2px)}.option-card[data-v-f496b0cc]:hover::before{opacity:1}.option-card[data-v-f496b0cc]:hover::after{left:100%}.option-card:hover .option-label[data-v-f496b0cc]{background:linear-gradient(135deg,#6366f1 0%,#ec4899 100%);transform:scale(1.05);box-shadow:0 4px 12px rgba(99,102,241,.5)}.option-card:hover .option-content[data-v-f496b0cc]{color:#f3f4f6}.option-card:hover .option-hint[data-v-f496b0cc]{opacity:1;transform:translateY(0)}.option-card[data-v-f496b0cc]:active{transform:translateY(0);box-shadow:0 2px 8px rgba(0,0,0,.2),0 1px 2px rgba(99,102,241,.15)}.option-label[data-v-f496b0cc]{display:inline-flex;align-items:center;justify-content:center;width:2.25rem;height:2.25rem;flex-shrink:0;background:linear-gradient(135deg,rgba(99,102,241,0.4) 0%,rgba(236,72,153,0.4) 100%);border:2px solid rgba(99,102,241,.5);border-radius:50%;color:#fff;font-weight:700;font-size:1rem;transition:all .3s cubic-bezier(0.4,0,0.2,1);box-shadow:0 2px 8px rgba(99,102,241,.4),inset 0 1px 0 hsla(0,0%,100%,.2);text-shadow:0 1px 2px rgba(0,0,0,.3)}.option-content[data-v-f496b0cc]{flex:1;color:#e5e7eb;font-size:.95rem;line-height:1.6;text-align:left;word-wrap:break-word;transition:color .3s ease;letter-spacing:.01em}.option-hint[data-v-f496b0cc]{display:none;align-items:center;gap:.5rem;color:rgba(236,72,153,.8);font-size:.8rem;font-weight:500;opacity:0;transform:translateY(10px);transition:all .3s ease;flex-shrink:0}.option-hint i[data-v-f496b0cc]{font-size:.85rem}.no-options[data-v-f496b0cc]{padding:3rem 2rem;text-align:center;color:#9ca3af;font-size:1rem}.no-options p[data-v-f496b0cc]{margin:0}@media (max-width:768px){.options-container[data-v-f496b0cc]{grid-template-columns:1fr;gap:.75rem}.option-card[data-v-f496b0cc]{padding:.875rem 1rem}.option-label[data-v-f496b0cc]{width:2rem;height:2rem;font-size:.9rem}.option-content[data-v-f496b0cc]{font-size:.9rem}}

/*# sourceMappingURL=main.css.map*/</style></head><body><div id="app"></div></body>