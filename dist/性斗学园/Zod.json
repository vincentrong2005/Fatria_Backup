{
  "type": "script",
  "enabled": true,
  "name": "Zod 变量结构",
  "id": "f840d212-0741-4e27-a1ad-3d896da446f3",
  "content": "import { registerMvuSchema } from 'https://testingcf.jsdelivr.net/gh/StageDog/tavern_resource/dist/util/mvu_zod.js';\n// DON'T IMPORT zod OR lodash HERE, USE THEM DIRECTLY!\n// --- 核心定义 (可复用) ---\n// 1. 定义加成统计 Schema\nconst BonusSchema = z.object({\n  魅力加成: z.coerce.number().prefault(0),\n  幸运加成: z.coerce.number().prefault(0),\n  基础性斗力加成: z.coerce.number().prefault(0),\n  基础性斗力成算: z.coerce.number().prefault(0),\n  基础忍耐力加成: z.coerce.number().prefault(0),\n  基础忍耐力成算: z.coerce.number().prefault(0),\n  闪避率加成: z.coerce.number().prefault(0),\n  暴击率加成: z.coerce.number().prefault(0),\n  意志力加成: z.coerce.number().prefault(0),\n}).prefault({});\n// 2. 定义临时状态 Schema\nconst TempStatusSchema = z.object({\n  状态列表: z.record(z.string(), z.coerce.number().describe(\"剩余回合\")).prefault({}),\n  加成统计: BonusSchema,\n}).prefault({});\n// 3. 定义关系 Schema\nconst RelationshipSchema = z.object({\n  好感度: z.coerce.number().transform(n => _.clamp(n, 0, 100)).prefault(0),\n  关系类型: z.enum([\"陌生人\", \"同学\", \"朋友\", \"恋人\", \"主仆\", \"完全臣服\", \"仇敌\"]).catch(\"陌生人\").prefault(\"陌生人\"),\n}).prefault({});\n// 4. 定义技能效果 Schema\nconst SkillEffectSchema = z.object({\n  效果类型: z.enum([\"性斗力\", \"忍耐力\", \"魅力\", \"幸运\", \"闪避率\", \"暴击率\", \"意志力\", \"束缚\"]).catch(\"性斗力\").prefault(\"性斗力\"),\n  效果值: z.coerce.number().prefault(0),\n  是否为百分比: z.boolean().prefault(false),\n  持续回合数: z.coerce.number().min(0).prefault(0),\n}).prefault({});\n// 5. 定义主动技能 Schema (用于玩家与对手)\nconst ActiveSkillSchema = z.object({\n  基本信息: z.object({\n    技能名称: z.string().prefault(\"\"),\n    技能描述: z.string().prefault(\"\"),\n    技能等级: z.coerce.number().transform(n => _.clamp(n, 1, 5)).prefault(1),\n    稀有度: z.enum([\"C\", \"B\", \"A\", \"S\", \"SS\"]).catch(\"C\").prefault(\"C\"),\n  }).prefault({}),\n  冷却与消耗: z.object({\n    耐力消耗: z.coerce.number().min(0).prefault(0),\n    冷却回合数: z.coerce.number().min(0).prefault(0),\n  }).prefault({}),\n  伤害与效果: z.object({\n    伤害来源: z.enum([\"性斗力\", \"魅力\", \"幸运\", \"意志力\", \"固定值\", \"目标快感\"]).catch(\"性斗力\").prefault(\"性斗力\"),\n    系数: z.coerce.number().prefault(100), // 百分比\n    基础命中率: z.coerce.number().prefault(100), // 百分比\n    效果列表: z.record(z.string(), SkillEffectSchema).prefault({}), // Key为效果自定义名称\n  }).prefault({}),\n  特殊机制: z.object({\n    是否忽视防御: z.boolean().prefault(false),\n    是否可被闪避: z.boolean().prefault(true),\n  }).prefault({}),\n});\n// 6. 定义物品系统相关 Schema\n// 6.1 已装备物品\nconst EquippedItemSchema = z.object({\n  名称: z.string().prefault(\"\"),\n  等级: z.enum([\"C\", \"B\", \"A\", \"S\", \"SS\"]).catch(\"C\").prefault(\"C\"),\n  加成属性: BonusSchema,\n  描述: z.string().prefault(\"\"),\n}).prefault({});\n// 6.2 背包物品 (使用 discriminatedUnion)\nconst BaseItemSchema = z.object({\n  等级: z.enum([\"C\", \"B\", \"A\", \"S\", \"SS\"]).catch(\"C\").prefault(\"C\"),\n  描述: z.string().prefault(\"\"),\n});\nconst EquipmentInBagSchema = BaseItemSchema.extend({\n  类型: z.literal(\"装备\"),\n  加成属性: BonusSchema,\n  部位: z.enum([\"主装备\", \"副装备\", \"饰品\", \"特殊装备\"]),\n  数量: z.literal(1).prefault(1),\n});\nconst ConsumableItemSchema = BaseItemSchema.extend({\n  类型: z.literal(\"消耗品\"),\n  加成属性: BonusSchema.optional(),\n  耐力增加: z.coerce.number().optional(),\n  快感降低: z.coerce.number().optional(),\n  战斗用品: z.boolean().prefault(false),\n  数量: z.coerce.number().min(0).prefault(1),\n});\nconst OtherItemSchema = BaseItemSchema.extend({\n  类型: z.literal(\"其他\"),\n  数量: z.coerce.number().min(0).prefault(1),\n});\nconst BackpackItemSchema = z.discriminatedUnion(\"类型\", [\n  EquipmentInBagSchema,\n  ConsumableItemSchema,\n  OtherItemSchema,\n]);\nexport const Schema = z.object({\n  // --- 角色基础 ---\n  角色基础: z.object({\n    _等级: z.coerce.number().transform(n => _.clamp(n, 1, 100)).prefault(1),\n    经验值: z.coerce.number().min(0).prefault(0),\n    声望: z.coerce.number().transform(n => _.clamp(n, -10000, 10000)).prefault(0),\n    _段位: z.enum([\"无段位\", \"D\", \"C\", \"B\", \"A\", \"S\", \"SS\", \"SSS\"]).prefault(\"无段位\"),\n  }).prefault({}),\n  // --- 核心状态 ---\n  核心状态: z.object({\n    $属性点: z.coerce.number().min(0).prefault(0),\n    $技能点: z.coerce.number().min(0).prefault(0),\n    $最大耐力: z.coerce.number().min(1).prefault(100),\n    $耐力: z.coerce.number().min(0).prefault(100),\n    $最大快感: z.coerce.number().min(1).prefault(100),\n    $快感: z.coerce.number().min(0).prefault(0),\n    堕落度: z.coerce.number().transform(n => _.clamp(n, 0, 100)).prefault(0),\n    _潜力: z.coerce.number().transform(n => _.clamp(n, 5.0, 10.0)).prefault(5.0),\n    _魅力: z.coerce.number().min(0).prefault(10),\n    $基础魅力: z.coerce.number().min(0).prefault(10),\n    _幸运: z.coerce.number().min(0).prefault(10),\n    $基础幸运: z.coerce.number().min(0).prefault(10),\n    $基础性斗力: z.coerce.number().prefault(10),\n    $基础忍耐力: z.coerce.number().prefault(10),\n    _闪避率: z.coerce.number().transform(n => _.clamp(n, 0, 60)).prefault(0),\n    $基础闪避率: z.coerce.number().min(0).prefault(0),\n    _暴击率: z.coerce.number().transform(n => _.clamp(n, 0, 100)).prefault(0),\n    $基础暴击率: z.coerce.number().min(0).prefault(0),\n    意志力: z.coerce.number().transform(n => _.clamp(n, 0, 100)).prefault(100),\n    $基础意志力: z.coerce.number().min(0).prefault(100),\n  }).prefault({}),\n  // --- 状态 ---\n  临时状态: TempStatusSchema,\n  永久状态: z.object({\n    状态列表: z.array(z.string()).prefault([]),\n    加成统计: BonusSchema,\n  }).prefault({}),\n  // --- 性斗系统 ---\n  性斗系统: z.object({\n    对手名称: z.string().prefault(\"\"),\n    对手等级: z.coerce.number().prefault(0),\n    性斗类型: z.enum([\"日常切磋\", \"决斗\", \"擂台赛\", \"校内赛\", \"多校联赛\", \"黑暗决赛\", \"无\"]).catch(\"无\").prefault(\"无\"),\n    胜负规则: z.object({\n      高潮次数上限: z.coerce.number().prefault(1),\n      允许认输: z.boolean().prefault(true),\n    }).prefault({}),\n    当前回合: z.coerce.number().min(0).prefault(0),\n    行动日志: z.record(z.string(), z.string()).prefault({}),\n    高潮次数: z.coerce.number().prefault(0),\n    实时性斗力: z.coerce.number().prefault(0),\n    实时忍耐力: z.coerce.number().prefault(0),\n    // --- 对手属性 (镜像复刻) ---\n    对手魅力: z.coerce.number().prefault(0),\n    对手幸运: z.coerce.number().prefault(0),\n    对手闪避率: z.coerce.number().prefault(0),\n    对手暴击率: z.coerce.number().prefault(0),\n    对手意志力: z.coerce.number().prefault(100),\n    对手耐力: z.coerce.number().prefault(100),\n    对手最大耐力: z.coerce.number().prefault(100),\n    对手快感: z.coerce.number().prefault(0),\n    对手最大快感: z.coerce.number().prefault(100),\n    对手高潮次数: z.coerce.number().prefault(0),\n    对手性斗力: z.coerce.number().prefault(0),\n    对手忍耐力: z.coerce.number().prefault(0),\n    对手临时状态: TempStatusSchema,\n    对手技能冷却: z.record(z.string(), z.coerce.number()).prefault({}),\n    // 对手可用技能: 结构与玩家主动技能完全对等\n    对手可用技能: z.record(z.string(), ActiveSkillSchema).prefault({}),\n    战斗物品: z.record(z.string(), z.number()).prefault({}),\n  }).prefault({}),\n  // --- 关系系统 ---\n  关系系统: z.object({\n    在场人物: z.array(z.string()).prefault([]),\n  }).catchall(RelationshipSchema).prefault({}),\n  // --- 任务系统 ---\n  任务系统: z.object({\n    主线任务: z.object({\n      名称: z.string().prefault(\"\"),\n      描述: z.string().prefault(\"\"),\n      状态: z.enum([\"进行中\", \"已完成\", \"已失败\", \"已放弃\"]).catch(\"进行中\").prefault(\"进行中\"),\n      目标: z.record(z.string(), z.any()).prefault({}),\n      奖励: z.string().prefault(\"\"),\n      期限: z.string().prefault(\"无\"),\n    }).prefault({}),\n    支线任务: z.record(z.string(), z.object({\n      描述: z.string().prefault(\"\"),\n      类型: z.enum([\"日常\", \"特殊\", \"限时\", \"隐藏\"]).catch(\"日常\").prefault(\"日常\"),\n      状态: z.enum([\"进行中\", \"已完成\", \"已失败\", \"已放弃\"]).catch(\"进行中\").prefault(\"进行中\"),\n      目标: z.record(z.string(), z.any()).prefault({}),\n      奖励: z.string().prefault(\"\"),\n      期限: z.string().prefault(\"无\"),\n    }).prefault({})).prefault({}),\n    已完成记录: z.array(z.string()).prefault([]),\n  }).prefault({}),\n  // --- 物品系统 (重构) ---\n  物品系统: z.object({\n    学园金币: z.coerce.number().min(0).prefault(0),\n    背包: z.record(z.string(), BackpackItemSchema).prefault({}),\n    _装备栏: z.object({\n      主装备: EquippedItemSchema,\n      副装备: EquippedItemSchema,\n      饰品1: EquippedItemSchema,\n      饰品2: EquippedItemSchema,\n      特殊装备: EquippedItemSchema,\n    }).prefault({}),\n    装备总加成: BonusSchema,\n  }).prefault({}),\n  // --- 位置与时间 ---\n  位置系统: z.object({\n    坐标: z.string().prefault(\"[1-1]\"),\n    楼层: z.coerce.number().prefault(1),\n    地点名称: z.string().prefault(\"初始点\"),\n  }).prefault({}),\n  时间系统: z.object({\n    日期: z.string().prefault(\"2025-3-17\"),\n    星期: z.coerce.number().transform(n => _.clamp(n, 1, 7)).prefault(1),\n    时间: z.string().prefault(\"08:00\"),\n  }).prefault({}),\n  // --- 势力声望 ---\n  势力声望: z.object({\n    学生会: z.coerce.number().transform(n => _.clamp(n, -100, 100)).prefault(0),\n    女权协会: z.coerce.number().transform(n => _.clamp(n, -100, 100)).prefault(0),\n    BF社: z.coerce.number().transform(n => _.clamp(n, -100, 100)).prefault(0),\n    体育联盟: z.coerce.number().transform(n => _.clamp(n, -100, 100)).prefault(0),\n    研究会: z.coerce.number().transform(n => _.clamp(n, -100, 100)).prefault(0),\n    地下联盟: z.coerce.number().transform(n => _.clamp(n, -100, 100)).prefault(0),\n    男性自保联盟: z.coerce.number().transform(n => _.clamp(n, -100, 100)).prefault(0),\n    雌堕会: z.coerce.number().transform(n => _.clamp(n, -100, 100)).prefault(0),\n  }).prefault({}),\n  // --- 技能系统 ---\n  技能系统: z.object({\n    // 主动技能: 复用 ActiveSkillSchema\n    主动技能: z.record(z.string(), ActiveSkillSchema).prefault({}),\n    // 被动技能已被抹除\n  }).prefault({}),\n});\n$(() => {\n  registerMvuSchema(Schema);\n})\n",
  "info": "",
  "button": {
    "enabled": true,
    "buttons": []
  },
  "data": {}
}