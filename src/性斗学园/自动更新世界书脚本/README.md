# 性斗学园 - 自动更新世界书脚本

## 功能说明

这个脚本可以自动检测角色卡的版本，并在发现新版本时自动从 CDN 更新角色卡。

## 使用方法

### 1. 在世界书中设置版本号

在角色卡的世界书中创建一个条目：

- **关键词**：`版本号` 或 `version`
- **内容示例**：
  ```
  当前版本: 1.0.0
  ```
  或
  ```
  version: 1.0.0
  ```

### 2. 配置脚本

打开 `index.js`，根据需要修改配置：

```javascript
const CONFIG = {
  // 角色卡 PNG 文件的 CDN 地址
  characterCardUrl: 'https://cdn.jsdelivr.net/gh/vincentrong2005/Fatria/src/性斗学园/性斗学院超级重制版.png',
  
  // 版本号文件的 CDN 地址
  versionFileUrl: 'https://cdn.jsdelivr.net/gh/vincentrong2005/Fatria/src/性斗学园/version.txt',
  
  // 是否启用自动更新
  autoUpdate: true,
  
  // 更新后刷新页面的延迟时间（毫秒）
  reloadDelay: 3000,
};
```

### 3. 在 SillyTavern 中使用

1. 将脚本内容复制到 SillyTavern 的 **STscript** 或 **Quick Reply** 中
2. 脚本会在执行时自动检查版本并更新

### 4. 发布新版本

当你更新角色卡后：

1. 更新 `version.txt` 文件中的版本号（如从 `1.0.0` 改为 `1.1.0`）
2. 上传新的角色卡 PNG 文件到 GitHub
3. 提交并推送到仓库
4. 用户的脚本会自动检测并更新

## 版本号格式

版本号采用 **语义化版本** 格式：`主版本号.次版本号.修订号`

- **主版本号**：重大更新，可能包含不兼容的改动
- **次版本号**：功能性更新，向后兼容
- **修订号**：Bug 修复和小改动

示例：
- `1.0.0` - 初始版本
- `1.1.0` - 添加新功能
- `1.1.1` - 修复 Bug
- `2.0.0` - 重大更新

## 工作原理

1. **读取本地版本**：从世界书中读取当前版本号
2. **获取远程版本**：从 CDN 获取 `version.txt` 中的最新版本号
3. **比较版本**：使用语义化版本比较算法
4. **自动更新**：如果远程版本更新，自动下载并导入新角色卡
5. **刷新页面**：更新完成后自动刷新 SillyTavern 页面

## 注意事项

- 确保 GitHub 仓库是公开的，或者使用正确的访问令牌
- CDN 可能有缓存，更新后可能需要等待几分钟才能生效
- 建议在测试环境中先验证脚本功能
- 如果不想自动更新，可以将 `autoUpdate` 设为 `false`，脚本只会提示有新版本

## 故障排查

### 脚本没有检测到版本号

- 检查世界书条目的关键词是否包含 `版本号` 或 `version`
- 检查版本号格式是否正确（如 `1.0.0`）

### 无法获取远程版本

- 检查网络连接
- 确认 CDN 地址是否正确
- 查看浏览器控制台的错误信息

### 更新失败

- 检查角色卡 PNG 文件是否存在
- 确认文件大小是否合理（不要太大）
- 查看控制台的详细错误信息

## 示例场景

假设当前版本是 `1.0.0`，你发布了 `1.1.0` 版本：

1. 更新 `version.txt` 内容为 `1.1.0`
2. 上传新的 `性斗学院超级重制版.png`
3. 用户打开 SillyTavern 时，脚本自动运行
4. 检测到 `1.0.0 < 1.1.0`
5. 自动下载并导入新角色卡
6. 显示提示："角色卡已从 1.0.0 更新到 1.1.0，准备刷新页面..."
7. 3 秒后自动刷新页面
8. 用户看到最新版本的角色卡

## 许可证

与项目主许可证相同
