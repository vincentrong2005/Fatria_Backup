# 酒馆助手游戏项目设计流程总结与提示词

## 一、项目设计流程总结

### 1. 页面流程设计

所有游戏项目都遵循统一的页面流程模式：

#### 标准流程（如 MHJG）
1. **开始屏幕（StartScreen）**
   - 全屏显示
   - 简单的"点击开始"提示
   - 支持键盘 Enter 键触发
   - 自动请求全屏模式
   - 淡入淡出动画

2. **标题页面（SplashScreen）**
   - 显示游戏标题和副标题
   - 背景图片/特效
   - 主要操作按钮：
     - 开始新游戏
     - 继续游戏（如果有存档）
     - 设置（可选）
     - 退出（可选）
   - 全屏切换按钮
   - 版权信息、作者信息、链接等页脚

3. **开局设置页面（NewGameSetup）**
   - 游戏配置表单
   - 玩家输入初始设置
   - 取消/确认按钮
   - 初始化游戏变量到酒馆变量系统

4. **正式游戏页面（Dashboard/Game）**
   - 主游戏界面
   - 导航栏/侧边栏
   - 内容区域
   - 模态框/弹窗系统
   - 数据展示和交互

#### 线性流程（如 horr）
1. **标题阶段（TITLE）** - 游戏标题展示
2. **加载阶段（LOADING）** - 加载动画/过渡
3. **表单阶段（CONTRACT）** - 用户输入表单
4. **警告阶段（WARNING）** - 警告/确认界面
5. **结束阶段（ENDING）** - 结束画面

### 2. 窗口大小规范

#### 基本规则
- **默认模式**：使用 `100vw` 和 `100vh` 占满整个 iframe
- **全屏模式**：支持浏览器全屏 API，全屏时使用 `100vw` 和 `100vh`
- **响应式设计**：
  - 桌面端：16:9 宽高比（可选）
  - 平板端：4:3 宽高比
  - 手机端：1:1 或 3:4 宽高比
  - 小屏手机：3:4 宽高比

#### CSS 实现示例
```scss
#app {
  width: 100%;
  min-height: 100%;
  height: 100%;
  position: relative;
}

// 全屏模式支持
html:fullscreen #app,
html:-webkit-full-screen #app,
html:-moz-full-screen #app,
html:-ms-fullscreen #app {
  width: 100vw !important;
  height: 100vh !important;
}
```

#### 全屏 API 使用
```typescript
// 请求全屏
const doc = document.documentElement;
if (doc.requestFullscreen) {
  doc.requestFullscreen().catch(err => console.log('全屏请求失败:', err));
} else if ((doc as any).webkitRequestFullscreen) {
  (doc as any).webkitRequestFullscreen();
}

// 退出全屏
if (document.exitFullscreen) {
  document.exitFullscreen();
}

// 监听全屏状态变化
document.addEventListener('fullscreenchange', () => {
  // 更新UI状态
});
```

### 3. 统一设计规则

#### 3.1 加载和卸载
- **加载时机**：使用 `$(() => {})` 而不是 `DOMContentLoaded`
- **卸载时机**：使用 `$(window).on('pagehide', () => {})` 而不是 `unload`
- **错误处理**：使用 `errorCatched()` 包装顶层函数

```typescript
$(() => {
  errorCatched(initializeApp)();
});

$(window).on('pagehide', () => {
  destroyApp();
});
```

#### 3.2 组件化设计
- **类组件模式**：每个页面/组件都是一个类
- **生命周期方法**：
  - `createElement()` - 创建 DOM 元素
  - `show()` - 显示组件
  - `hide()` - 隐藏组件
  - `destroy()` - 销毁组件
  - `render()` - 重新渲染（可选）

```typescript
export class MyComponent {
  private element: HTMLElement | null = null;
  private callbacks: MyComponentCallbacks;
  
  constructor(callbacks: MyComponentCallbacks) {
    this.callbacks = callbacks;
  }
  
  public createElement(): HTMLElement {
    const div = document.createElement('div');
    div.className = 'my-component';
    div.innerHTML = this.getHTML();
    this.element = div;
    this.bindEvents();
    return div;
  }
  
  public show(): void {
    if (this.element) {
      $(this.element).addClass('visible');
    }
  }
  
  public hide(): void {
    if (this.element) {
      $(this.element).removeClass('visible');
    }
  }
  
  public destroy(): void {
    if (this.element) {
      $(this.element).off();
      $(this.element).remove();
      this.element = null;
    }
  }
  
  private bindEvents(): void {
    // 绑定事件
  }
  
  private getHTML(): string {
    // 返回 HTML 字符串
    return '';
  }
}
```

#### 3.3 状态管理
- **页面状态**：使用枚举或字符串字面量类型
```typescript
type PageState = 'start' | 'splash' | 'setup' | 'game';
let currentPage: PageState = 'start';
```

- **游戏状态**：从酒馆变量系统读取和写入
```typescript
// 读取变量
const gameData = await readGameData();

// 写入变量
await updateStatDataVariable('路径.到.变量', value);
```

#### 3.4 事件监听
- **酒馆事件**：使用 `eventOn()` 监听酒馆事件
```typescript
eventOn(tavern_events.MESSAGE_UPDATED, (message_id: number) => {
  // 刷新数据
  refreshAllComponents();
});
```

#### 3.5 样式规范
- **SCSS 变量**：统一使用变量文件
- **响应式**：使用媒体查询
- **动画**：使用 CSS transition 和 animation
- **滚动条**：自定义滚动条样式

```scss
// variables.scss
$color-bg-deep: #0f172a;
$color-text-main: #e2e8f0;
$spacing-sm: 8px;
$spacing-md: 16px;
$spacing-lg: 24px;

// 响应式
@media (max-width: 768px) {
  // 移动端样式
}
```

### 4. 模块化设计

#### 4.1 目录结构
```
项目名称/
├── components/          # 组件目录
│   ├── StartScreen.ts
│   ├── StartScreen.scss
│   ├── SplashScreen.ts
│   ├── SplashScreen.scss
│   ├── Dashboard.ts
│   ├── Dashboard.scss
│   └── modals/          # 模态框组件
│       ├── Modal1.ts
│       └── Modal1.scss
├── utils/               # 工具函数
│   ├── variableReader.ts
│   ├── variableUpdater.ts
│   ├── gameInitializer.ts
│   └── textParser.ts
├── types/               # 类型定义
│   ├── gameConfig.ts
│   └── types.ts
├── styles/              # 全局样式
│   ├── main.scss
│   └── variables.scss
├── index.html           # HTML 入口
├── index.ts             # TypeScript 入口
└── metadata.json        # 项目元数据
```

#### 4.2 组件职责分离
- **展示组件**：负责 UI 渲染
- **逻辑组件**：负责业务逻辑
- **工具函数**：负责数据处理、变量读写
- **类型定义**：负责类型安全

#### 4.3 数据流
```
酒馆变量系统
    ↓
variableReader.ts (读取)
    ↓
组件状态 (Component State)
    ↓
用户交互
    ↓
variableUpdater.ts (写入)
    ↓
酒馆变量系统
    ↓
事件触发 (MESSAGE_UPDATED)
    ↓
刷新组件 (refreshAllComponents)
```

## 二、LLM 提示词模板

### 提示词：构建酒馆助手游戏项目

你是一个专业的全栈开发工程师，需要为酒馆助手（Tavern Helper）创建一个新的游戏前端界面项目。请按照以下规范和要求进行开发。

#### 项目基本信息
- **项目名称**：[项目名称]
- **项目描述**：[项目描述]
- **技术栈**：[TypeScript + jQuery + SCSS] 或 [React + TypeScript + Tailwind CSS]

#### 页面流程要求

请实现以下页面流程（根据项目需求选择）：

**方案A：标准流程（适用于经营类、管理类游戏）**
1. **开始屏幕（StartScreen）**
   - 全屏显示，背景色为深色主题
   - 显示"点击此处开始"或类似提示
   - 支持点击和 Enter 键触发
   - 点击后自动请求全屏模式
   - 淡入淡出动画效果

2. **标题页面（SplashScreen）**
   - 显示游戏标题和副标题
   - 背景图片或特效
   - 按钮：
     - "开始新游戏"（主要按钮）
     - "继续游戏"（如果有存档数据）
     - "设置"（可选）
     - "退出"（可选）
   - 全屏切换按钮
   - 页脚：版本号、作者、版权、链接等

3. **开局设置页面（NewGameSetup）**
   - 游戏配置表单
   - 玩家输入初始设置（如：旅店名称、初始资金、难度等）
   - "取消"按钮（返回标题页）
   - "确认"按钮（初始化游戏并进入游戏页面）



**方案B：线性流程（适用于叙事类、互动小说类游戏）**
1. **标题阶段（TITLE）** - 游戏标题展示
2. **加载阶段（LOADING）** - 加载动画/过渡效果
3. **表单阶段（CONTRACT）** - 用户输入表单
4. **警告阶段（WARNING）** - 警告/确认界面
5. **结束阶段（ENDING）** - 结束画面

#### 窗口大小规范

- **默认模式**：
  ```scss
  #app {
    width: 100%;
    min-height: 100%;
    height: 100%;
    position: relative;
  }
  ```

- **全屏模式支持**：
  ```scss
  html:fullscreen #app,
  html:-webkit-full-screen #app,
  html:-moz-full-screen #app,
  html:-ms-fullscreen #app {
    width: 100vw !important;
    height: 100vh !important;
  }
  ```

- **响应式设计**：
  - 桌面端：16:9 宽高比（可选）
  - 平板端（≤768px）：4:3 宽高比
  - 手机端（≤480px）：1:1 或 3:4 宽高比

#### 技术实现要求

1. **加载和卸载**
   ```typescript
   // 使用 jQuery 加载
   $(() => {
     errorCatched(initializeApp)();
   });
   
   // 使用 pagehide 卸载
   $(window).on('pagehide', () => {
     destroyApp();
   });
   ```

2. **组件化设计**
   - 每个页面/组件都是一个类
   - 实现 `createElement()`, `show()`, `hide()`, `destroy()` 方法
   - 使用回调函数处理用户交互

3. **状态管理**
   - 使用枚举或字符串字面量类型管理页面状态
   - 从酒馆变量系统读取游戏数据
   - 使用 `updateStatDataVariable()` 更新变量

4. **事件监听**
   - 使用 `eventOn()` 监听酒馆事件（如 `MESSAGE_UPDATED`）
   - 事件触发时刷新组件数据

5. **样式规范**
   - 使用 SCSS 变量统一管理颜色、间距等
   - 实现响应式设计
   - 使用 CSS transition 和 animation 实现动画效果

#### 目录结构

请创建以下目录结构：
```
[项目名称]/
├── components/          # 组件目录
│   ├── [ComponentName].ts
│   ├── [ComponentName].scss
│   └── modals/         # 模态框组件（如需要）
├── utils/              # 工具函数
│   ├── variableReader.ts
│   ├── variableUpdater.ts
│   └── [其他工具函数].ts
├── types/              # 类型定义
│   ├── types.ts
│   └── [其他类型文件].ts
├── styles/             # 全局样式
│   ├── main.scss
│   └── variables.scss
├── index.html          # HTML 入口
├── index.ts            # TypeScript 入口（或 index.tsx）
└── metadata.json       # 项目元数据
```

#### 数据流设计

1. **初始化流程**：
   - 检查是否有存档（通过 `getLastMessageId()` 判断）
   - 如果有存档，直接进入游戏页面
   - 如果没有存档，进入标题页面

2. **数据读取**：
   - 从酒馆变量系统读取游戏数据（使用 `getVariables()`）
   - 解析数据并更新组件状态

3. **数据写入**：
   - 用户交互触发数据更新
   - 使用 `replaceVariables()` 或 `updateStatDataVariable()` 写入变量
   - 监听 `MESSAGE_UPDATED` 事件刷新组件

#### 样式主题

- **深色主题**：背景色 `#0f172a`，文字色 `#e2e8f0`
- **玻璃态效果**：使用半透明背景和模糊效果
- **动画效果**：淡入淡出、缩放、滑动等过渡动画
- **字体**：使用中文字体（如 Noto Serif SC）和英文字体（如 Outfit）

#### 特殊功能（根据项目需求）

1. **全屏功能**：实现全屏切换按钮和全屏状态管理
2. **模态框系统**：实现模态框的显示、隐藏、数据刷新
3. **数据持久化**：使用酒馆变量系统持久化游戏数据
4. **事件响应**：监听酒馆消息事件，自动刷新数据

#### 代码质量要求

1. **TypeScript**：使用 TypeScript 而非 JavaScript
2. **类型安全**：定义清晰的类型和接口
3. **错误处理**：使用 `errorCatched()` 包装顶层函数
4. **日志记录**：使用 `console.log`, `console.warn`, `console.error` 记录关键操作
5. **代码注释**：为关键函数和复杂逻辑添加注释

#### 测试要求

1. **页面流程测试**：确保所有页面能正常切换
2. **全屏功能测试**：确保全屏模式正常工作
3. **响应式测试**：确保在不同屏幕尺寸下正常显示
4. **数据持久化测试**：确保数据能正确读写

#### 输出要求

请按照以下顺序输出代码：

1. **metadata.json** - 项目元数据
2. **index.html** - HTML 入口文件
3. **types/** - 类型定义文件
4. **styles/variables.scss** - 样式变量
5. **styles/main.scss** - 全局样式
6. **components/** - 组件文件（按页面流程顺序）
7. **utils/** - 工具函数
8. **index.ts** - 主入口文件

每个文件请包含完整的代码，不要省略任何部分。

---

**注意事项**：
- 所有代码必须可以直接运行，不要有占位符或 TODO
- 确保所有导入路径正确
- 确保所有类型定义完整
- 确保所有样式类名与 HTML 结构匹配
- 确保所有事件绑定正确
- 确保所有回调函数正确处理

请开始创建项目代码。

